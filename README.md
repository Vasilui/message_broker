# message_broker

## Тестовое задание на позицию Go разработчика

## Создание базы данных
### Все описание базы данных находится в файле database/psql.db.sql
### После создания базы можно запускать проект

## Запуск прокета:
```go
go run main.go
```

После запуска проекта  произойдет обращение к базе данных, из токорой забираются все пользователи.
Для каждого пользователя запускается goroutine в которой в бесконечном цикле из базы вытаскиваются таски
конкретного пользователя. Таски делятся на два типа: пополнение баланса и его списание. Если баланс 
недостаточен для списания, то таска отменяется.

## Примеры обращения к API

### Создание нового пользователя
POST запрос на endpoint:
```pyton
http://localhost:3333/api/v1/user/
```
Пример тела запроса (все параметры обзязательны)
```json
{
	"username": "User5",
	"balance": 500
}
```
Пример ответа:
```json
{
	"id": "5",
	"username": "User5",
	"balance": 500
}
```
### Запрос на получение информации о пользователе
GET запрос на endpoint:
```python
http://localhost:3333/api/v1/user/<id>
```
Пример ответа:
```json
{
	"id": "5",
	"username": "User5",
	"balance": 500
}
```
### Получение информации о всех пользователях
GET запрос на endpoint:
```python
http://localhost:3333/api/v1/user/
```
Пример ответа:
```json
[
	{
		"id": "1",
		"username": "User1",
		"balance": 1700
	},
	{
		"id": "2",
		"username": "User2",
		"balance": 2900
	},
	{
		"id": "3",
		"username": "User3",
		"balance": 3800
	},
	{
		"id": "4",
		"username": "User4",
		"balance": 1400
	},
	{
		"id": "5",
		"username": "User5",
		"balance": 500
	}
]
```
### Запрос  на изменение баланса конкретного пользователя (пополнение)
POST запрос на endpoint:
```pyton
http://localhost:3333/api/v1/user/4/amount/
```
Пример тела запроса (все параметры обзязательны)
```json
{
      "type": "replenishment",
      "amount": 500
}
```
### Запрос  на изменение баланса конкретного пользователя (списание)
POST запрос на endpoint:
```pyton
http://localhost:3333/api/v1/user/4/amount/
```
Пример тела запроса (все параметры обзязательны)
```json
{
      "type": "write-off",
      "amount": 600
}
```

